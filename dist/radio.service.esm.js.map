{"version":3,"file":"radio.service.esm.js","sources":["../src/index.js"],"sourcesContent":["import Radio from 'backbone.radio'\r\nimport {Model} from 'backbone'\r\nimport _ from 'underscore'\r\n\r\nconst resolved = Promise.resolve()\r\n\r\nconst extend = Model.extend\r\n\r\n/**\r\n * @class Service\r\n */\r\n\r\nconst Service = extend.call(Radio.Channel, {\r\n  constructor () {\r\n    const start = _.once(() => resolved.then(() => this.start()))\r\n    const requests = _.result(this, 'requests')\r\n    _.each(requests, (val, key) => {\r\n      this.reply(key, (...args) => {\r\n        let promise = start().then(() => this[val](...args))\r\n\r\n        promise.catch(err => {\r\n          this.onError(err)\r\n        })\r\n\r\n        return promise\r\n      })\r\n    })\r\n\r\n    Radio.Channel.prototype.constructor.apply(this, arguments)\r\n  },\r\n  /**\r\n   * @abstract\r\n   * @method setup\r\n   */\r\n  setup () {},\r\n\r\n  /**\r\n   * @abstract\r\n   * @method start\r\n   */\r\n  start () {},\r\n\r\n  /**\r\n   * @abstract\r\n   * @method onError\r\n   */\r\n  onError () {}\r\n})\r\n\r\nService.extend = extend\r\n\r\nexport default Service\r\n"],"names":["resolved","Promise","resolve","extend","Model","Service","call","Radio","Channel","start","_","once","then","requests","result","each","val","key","reply","args","promise","catch","onError","err","prototype","constructor","apply","arguments"],"mappings":";;;;AAIA,IAAMA,WAAWC,QAAQC,OAAR,EAAjB;;AAEA,IAAMC,SAASC,MAAMD,MAArB;;;;;;AAMA,IAAME,UAAUF,OAAOG,IAAP,CAAYC,MAAMC,OAAlB,EAA2B;aAAA,yBAC1B;;;QACPC,QAAQC,EAAEC,IAAF,CAAO;aAAMX,SAASY,IAAT,CAAc;eAAM,MAAKH,KAAL,EAAN;OAAd,CAAN;KAAP,CAAd;QACMI,WAAWH,EAAEI,MAAF,CAAS,IAAT,EAAe,UAAf,CAAjB;MACEC,IAAF,CAAOF,QAAP,EAAiB,UAACG,GAAD,EAAMC,GAAN,EAAc;YACxBC,KAAL,CAAWD,GAAX,EAAgB,YAAa;0CAATE,IAAS;cAAA;;;YACvBC,UAAUX,QAAQG,IAAR,CAAa;iBAAM,MAAKI,GAAL,eAAaG,IAAb,CAAN;SAAb,CAAd;;gBAEQE,KAAR,CAAc,eAAO;gBACdC,OAAL,CAAaC,GAAb;SADF;;eAIOH,OAAP;OAPF;KADF;;UAYMZ,OAAN,CAAcgB,SAAd,CAAwBC,WAAxB,CAAoCC,KAApC,CAA0C,IAA1C,EAAgDC,SAAhD;GAhBuC;;;;;;OAAA,mBAsBhC,EAtBgC;;;;;;;OAAA,mBA4BhC,EA5BgC;;;;;;;SAAA,qBAkC9B;CAlCG,CAAhB;;AAqCAtB,QAAQF,MAAR,GAAiBA,MAAjB;;;;"}