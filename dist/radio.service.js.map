{"version":3,"file":"radio.service.js","sources":["../src/index.js"],"sourcesContent":["import Radio from 'backbone.radio'\r\nimport {Model} from 'backbone'\r\nimport _ from 'underscore'\r\n\r\nconst resolved = Promise.resolve()\r\n\r\nconst extend = Model.extend\r\n\r\n/**\r\n * @class Service\r\n */\r\n\r\nconst Service = extend.call(Radio.Channel, {\r\n  constructor () {\r\n    const start = _.once(() => resolved.then(() => this.start()))\r\n    const requests = _.result(this, 'requests')\r\n    _.each(requests, (val, key) => {\r\n      this.reply(key, (...args) => {\r\n        let promise = start().then(() => this[val](...args))\r\n\r\n        promise.catch(err => {\r\n          this.onError(err)\r\n        })\r\n\r\n        return promise\r\n      })\r\n    })\r\n\r\n    Radio.Channel.prototype.constructor.apply(this, arguments)\r\n  },\r\n  /**\r\n   * @abstract\r\n   * @method setup\r\n   */\r\n  setup () {},\r\n\r\n  /**\r\n   * @abstract\r\n   * @method start\r\n   */\r\n  start () {},\r\n\r\n  /**\r\n   * @abstract\r\n   * @method onError\r\n   */\r\n  onError () {}\r\n})\r\n\r\nService.extend = extend\r\n\r\nexport default Service\r\n"],"names":["resolved","Promise","resolve","extend","Model","Service","call","Radio","Channel","constructor","start","_","once","then","requests","result","each","val","key","reply","args","promise","catch","onError","err","prototype","apply","arguments","setup"],"mappings":";;;;;;;;;EAIA,IAAMA,WAAWC,QAAQC,OAAR,EAAjB;;EAEA,IAAMC,SAASC,eAAMD,MAArB;;EAEA;;;;EAIA,IAAME,UAAUF,OAAOG,IAAP,CAAYC,MAAMC,OAAlB,EAA2B;EACzCC,aADyC,yBAC1B;EAAA;;EACb,QAAMC,QAAQC,EAAEC,IAAF,CAAO;EAAA,aAAMZ,SAASa,IAAT,CAAc;EAAA,eAAM,MAAKH,KAAL,EAAN;EAAA,OAAd,CAAN;EAAA,KAAP,CAAd;EACA,QAAMI,WAAWH,EAAEI,MAAF,CAAS,IAAT,EAAe,UAAf,CAAjB;EACAJ,MAAEK,IAAF,CAAOF,QAAP,EAAiB,UAACG,GAAD,EAAMC,GAAN,EAAc;EAC7B,YAAKC,KAAL,CAAWD,GAAX,EAAgB,YAAa;EAAA,0CAATE,IAAS;EAATA,cAAS;EAAA;;EAC3B,YAAIC,UAAUX,QAAQG,IAAR,CAAa;EAAA,iBAAM,MAAKI,GAAL,eAAaG,IAAb,CAAN;EAAA,SAAb,CAAd;;EAEAC,gBAAQC,KAAR,CAAc,eAAO;EACnB,gBAAKC,OAAL,CAAaC,GAAb;EACD,SAFD;;EAIA,eAAOH,OAAP;EACD,OARD;EASD,KAVD;;EAYAd,UAAMC,OAAN,CAAciB,SAAd,CAAwBhB,WAAxB,CAAoCiB,KAApC,CAA0C,IAA1C,EAAgDC,SAAhD;EACD,GAjBwC;;EAkBzC;;;;EAIAC,OAtByC,mBAsBhC,EAtBgC;;;EAwBzC;;;;EAIAlB,OA5ByC,mBA4BhC,EA5BgC;;;EA8BzC;;;;EAIAa,SAlCyC,qBAkC9B;EAlC8B,CAA3B,CAAhB;;EAqCAlB,QAAQF,MAAR,GAAiBA,MAAjB;;;;;;;;"}